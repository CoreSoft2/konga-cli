#!/usr/bin/env node

var program = require('commander');
var plugins = require('../commands/plugins');
var fail = require('../lib/fail');
var configurator = require('../lib/configurator');


program
  .command('list')
  .option('--on <api-name>', 'the API whose plugin to list')
  .action(function (options) {
    if (typeof options.on !== 'string') {
      fail(Error('listing all plugins is not supported yet'))
    }
    plugins.list(options.on, function (err, plugins) {
      if (err) fail(err);
      console.log(plugins)
    })
  })

program
  .command('set <plugin-name> [fields...]')
  .option('--on <api-name>', 'the API on which to configure the plugin')
  .action(function (plugin, fields, options) {
    if (typeof options.on !== 'string') {
      fail(Error("you MUST specify a target API with the --on <api-name> option"))
    }
    var config = configurator(fields);
    //console.log(fields);
    //console.log(config);
    //return;
    plugins.set(options.on, plugin, configurator(fields), function (err, result) {
      if (err) fail(err);
      console.log(result);
    })
  })
program.parse(process.argv)

